---
layout: post
title: How to fix VPN on MacOS Sonoma
date: 2023-01-14 15:13:16.000000000 +03:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories: []
tags: []
meta: {}
permalink: "/2023/01/14/macos-vpn-sonoma/"
---
<p><!-- wp:paragraph --></p>
<p>Apple recently broke its IKEv2 client in MacOS Sonoma.</p>
<p>Symptoms are: vpn is disconnected every 25 minutes or so.
    The internet is full of bug reports and long discussions like <a
            href="https://github.com/hwdsl2/setup-ipsec-vpn/issues/1486">this one</a>.
</p>
<p>As of MacOS 14.2.1 there's no fix for this.</p>
<p>Hopefully Alexey can help.</p>
<ol>
    <li>Open <b>Shortcuts</b> app</li>
    <li>Create new shortcut like this one. Put name of your VPN connection in the "VPN" field of the command.
        <img src="/assets/shortcuts.png">
    </li>
    <li>Create script <b>vpn.sh</b> with the following content:
        <pre>
            #!/bin/zsh

            while true; do
            shortcuts run "Reconnect VPN"
            sleep 2
            done
        </pre>
    </li>
    <li>Run the script. It will work indefinitely until you kill it.
        <pre>
            ./vpn.sh
        </pre></li>
        You can play with sleep amount to tune your connection restore time vs battery and cpu usage.
    <li>Now your VPN connection is restored every time it breaks. The script takes CPU time, but it seems like a good
        tradeoff
        for working around OS bug.
    </li>

</ol>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --></p>
